<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Energy Heart Explosion - Trần Anh Thư</title>
  <style>
    body {
      margin: 0;
      background: #000;
      overflow: hidden;
    }
    #explosionText {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.2);
      font-size: 4rem;
      color: #fff;
      font-family: 'Segoe UI', Arial, sans-serif;
      letter-spacing: 5px;
      text-shadow:
        0 0 20px #fa1, 
        0 0 60px #f24,
        0 0 16px #f2a,
        0 0 80px #fff;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.4s, transform 0.7s cubic-bezier(.68,-0.55,.27,1.55);
      z-index: 10;
    }
  </style>
</head>
<body>
  <canvas id="heartCanvas"></canvas>
  <div id="explosionText">Trần Anh Thư</div>
  <script>
    // ----------- Canvas Setup -----------
    const canvas = document.getElementById("heartCanvas");
    const ctx = canvas.getContext("2d");
    let w = window.innerWidth, h = window.innerHeight;
    canvas.width = w;
    canvas.height = h;

    // ----------- Heart Energy Effect -----------
    function heart(t, scale=1) {
      let x = 16 * Math.pow(Math.sin(t), 3);
      let y = 13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t);
      return {
        x: w/2 + scale * x * 22,
        y: h/2 - scale * y * 22
      };
    }

    let phase = "energy"; // energy, explode, text, text-explode, done
    let explosionProgress = 0;
    let textExplosionProgress = 0;
    let tinyHearts = [];
    let textParticles = [];
    let explosionTime = 0;
    let textShowTime = 0;
    const explosionDuration = 1.0; // seconds
    const textExplosionDuration = 1.2; // seconds

    // ----------- Draw Energy -----------
    function drawEnergy(now) {
      for (let i = 0; i < 140; i++) {
        let t = (i / 140) * 2 * Math.PI;
        let wave = Math.sin(now*0.8 + t*6 + Math.cos(now*1.3+t*3)*2);
        let scale = 1 + 0.12 * wave + 0.05 * Math.sin(now*2.2 + t*8);
        let p1 = heart(t, scale);
        let p2 = heart(t, scale*0.85);
        let glow = 0.5 + 0.5*Math.sin(now + t*8);
        ctx.beginPath();
        ctx.moveTo(p1.x, p1.y);
        ctx.lineTo(p2.x, p2.y);
        ctx.strokeStyle = `rgba(${220+25*glow},${20+40*glow},${60+60*glow},${0.14+0.09*glow})`;
        ctx.shadowColor = `#FF2B6D`;
        ctx.shadowBlur = 12 + 8 * Math.abs(wave);
        ctx.lineWidth = 2.1 + 1.2*Math.abs(wave);
        ctx.stroke();
      }
      // Moving sparks
      for (let i = 0; i < 18; i++) {
        let t = now*2.1 + i*13.8;
        let p = heart((Math.sin(t)+1) * Math.PI, 1.05 + 0.08 * Math.cos(t));
        ctx.beginPath();
        ctx.arc(p.x, p.y, 2.2+2*Math.random(), 0, 2*Math.PI);
        ctx.fillStyle = "rgba(255,255,255,0.17)";
        ctx.shadowColor = "#f6f";
        ctx.shadowBlur = 22;
        ctx.fill();
      }
    }

    // ----------- Heart Explosion Effect -----------
    function drawExplosion(progress) {
      // Draw energy lines flying out
      for (let i = 0; i < 80; i++) {
        let t = (i / 80) * 2 * Math.PI;
        let angle = t + Math.random()*0.1;
        let radius = 0.6 + 2.7 * progress * (0.7+0.5*Math.random());
        let p1 = heart(t, 1);
        let p2 = {
          x: w/2 + Math.cos(angle) * 260 * progress * (0.8+0.5*Math.random()),
          y: h/2 + Math.sin(angle) * 220 * progress * (0.8+0.5*Math.random())
        };
        ctx.beginPath();
        ctx.moveTo(p1.x, p1.y);
        ctx.lineTo(p2.x, p2.y);
        ctx.strokeStyle = `rgba(255,80,160,${1-progress})`;
        ctx.shadowColor = "#fff";
        ctx.shadowBlur = 32;
        ctx.lineWidth = 2 + 4*(1-progress);
        ctx.stroke();
      }
      // Heart fading out
      ctx.save();
      ctx.globalAlpha = 1-progress;
      for (let i = 0; i < 100; i++) {
        let t = (i / 100) * 2 * Math.PI;
        let p = heart(t, 1);
        ctx.beginPath();
        ctx.arc(p.x, p.y, 2.6, 0, 2*Math.PI);
        ctx.fillStyle = "#ff2b6d";
        ctx.shadowColor = "#fff";
        ctx.shadowBlur = 18;
        ctx.fill();
      }
      ctx.restore();
    }

    // ----------- Text Heart Explosion -----------
    function createTextParticles() {
      // Get position of the text div
      const textDiv = document.getElementById("explosionText");
      const rect = textDiv.getBoundingClientRect();
      // Pick random points inside the text area
      const number = 90;
      for (let i = 0; i < number; i++) {
        let x = rect.left + Math.random()*rect.width;
        let y = rect.top + Math.random()*rect.height*0.8 + rect.height*0.1;
        let angle = Math.random()*2*Math.PI;
        let speed = 2.8 + 3*Math.random();
        let color = `hsl(${340+Math.random()*40},100%,${60+Math.random()*30}%)`;
        textParticles.push({
          x, y,
          vx: Math.cos(angle)*speed,
          vy: Math.sin(angle)*speed,
          alpha: 1,
          color,
          size: 11 + 9*Math.random(),
          gravity: 0.12 + 0.12*Math.random()
        });
      }
    }
    function drawTextParticles() {
      for (let p of textParticles) {
        // Heart shape
        ctx.save();
        ctx.globalAlpha = p.alpha;
        ctx.translate(p.x, p.y);
        ctx.scale(0.16 + p.size*0.014, 0.16 + p.size*0.014);
        ctx.beginPath();
        for (let t = 0; t <= Math.PI*2; t += 0.15) {
          let x = 16 * Math.pow(Math.sin(t), 3);
          let y = 13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t);
          if (t === 0)
            ctx.moveTo(x, y);
          else
            ctx.lineTo(x, y);
        }
        ctx.closePath();
        ctx.fillStyle = p.color;
        ctx.shadowColor = p.color;
        ctx.shadowBlur = 6 + 7*Math.random();
        ctx.fill();
        ctx.restore();
      }
    }

    // ----------- Animation Loop -----------
    function animate() {
      ctx.globalAlpha = 0.19;
      ctx.fillStyle = "#000";
      ctx.fillRect(0, 0, w, h);
      ctx.globalAlpha = 1;
      let now = performance.now() * 0.001;

      if (phase === "energy") {
        drawEnergy(now);
      }

      if (phase === "explode") {
        drawExplosion(explosionProgress);
        if (explosionProgress < 1) {
          explosionProgress += 1/60 / explosionDuration;
        } else {
          phase = "text";
          document.getElementById("explosionText").style.opacity = 1;
          document.getElementById("explosionText").style.transform = "translate(-50%, -50%) scale(1)";
          textShowTime = performance.now();
        }
      }

      if (phase === "text" || phase === "text-explode") {
        // Draw nothing here, just let the text div show
      }

      if (phase === "text-explode") {
        drawTextParticles();
        // Update particles
        for (let p of textParticles) {
          p.x += p.vx;
          p.y += p.vy;
          p.vy += p.gravity;
          p.alpha -= 0.011 + Math.random()*0.008;
        }
        textParticles = textParticles.filter(p => p.alpha > 0.05);
        if (textParticles.length === 0) phase = "done";
      }

      requestAnimationFrame(animate);
    }

    animate();

    // ----------- Timers for Phases -----------
    setTimeout(() => {
      phase = "explode";
      explosionProgress = 0;
      document.getElementById("explosionText").style.opacity = 0;
    }, 5000);

    setTimeout(() => {
      // Show text with animation
      document.getElementById("explosionText").style.opacity = 1;
      document.getElementById("explosionText").style.transform = "translate(-50%, -50%) scale(1.08)";
      setTimeout(() => {
        document.getElementById("explosionText").style.transform = "translate(-50%, -50%) scale(1)";
      }, 600);
    }, 6200);

    setTimeout(() => {
      // Text explode to tiny hearts
      document.getElementById("explosionText").style.opacity = 0;
      createTextParticles();
      phase = "text-explode";
    }, 8200);

    window.addEventListener('resize', () => {
      w = window.innerWidth;
      h = window.innerHeight;
      canvas.width = w;
      canvas.height = h;
    });
  </script>
</body>
</html>
