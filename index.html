<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Heart Explosion</title>
  <style>
    html, body {
      margin: 0;
      overflow: hidden;
      background: black;
    }
    canvas {
      display: block;
    }
    #text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 48px;
      font-family: 'Arial', sans-serif;
      color: white;
      opacity: 0;
      transition: opacity 2s ease-in-out;
      pointer-events: none;
      white-space: nowrap;
    }
  </style>
</head>
<body>
  <canvas id="canvas"></canvas>
  <div id="text">Trần Anh Thư</div>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let w = canvas.width = window.innerWidth;
    let h = canvas.height = window.innerHeight;

    window.addEventListener("resize", () => {
      w = canvas.width = window.innerWidth;
      h = canvas.height = window.innerHeight;
    });

    let particles = [];
    let showHeart = true;
    let phase = "build";

    function createHeartParticles() {
      particles = [];
      for (let i = 0; i < 200; i++) {
        let t = Math.PI * 2 * (i / 200);
        let x = 16 * Math.pow(Math.sin(t), 3);
        let y = -(13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t));
        particles.push({
          x: w/2,
          y: h/2,
          tx: w/2 + x * 20,
          ty: h/2 + y * 20,
          alpha: 1,
          exploded: false
        });
      }
    }

    createHeartParticles();

    function animate() {
      if (!showHeart && phase === "done") return;

      // Chỉ phủ nền mờ khi còn hiệu ứng
      if (showHeart || phase === "explode" || phase === "text-explode") {
        ctx.globalAlpha = 0.19;
        ctx.fillStyle = "#000";
        ctx.fillRect(0, 0, w, h);
        ctx.globalAlpha = 1;
      }

      if (showHeart) {
        particles.forEach(p => {
          p.x += (p.tx - p.x) * 0.05;
          p.y += (p.ty - p.y) * 0.05;
          ctx.strokeStyle = `rgba(255,105,180,${p.alpha})`;
          ctx.beginPath();
          ctx.moveTo(w/2, h/2);
          ctx.lineTo(p.x, p.y);
          ctx.stroke();
        });
      } else if (phase === "explode") {
        particles.forEach(p => {
          if (!p.exploded) {
            let angle = Math.random() * 2 * Math.PI;
            let speed = 5 + Math.random() * 5;
            p.vx = Math.cos(angle) * speed;
            p.vy = Math.sin(angle) * speed;
            p.exploded = true;
          }
          p.x += p.vx;
          p.y += p.vy;
          p.alpha -= 0.01;
          if (p.alpha > 0) {
            ctx.fillStyle = `rgba(255,105,180,${p.alpha})`;
            ctx.beginPath();
            ctx.arc(p.x, p.y, 2, 0, 2 * Math.PI);
            ctx.fill();
          }
        });

        if (particles.every(p => p.alpha <= 0)) {
          phase = "text-explode";
          document.getElementById("text").style.opacity = 1;
          canvas.style.display = "none"; // ✅ Ẩn canvas hoàn toàn
          setTimeout(() => {
            phase = "done"; // ✅ Ngừng hẳn animate()
          }, 2000);
        }
      }

      requestAnimationFrame(animate);
    }

    setTimeout(() => {
      showHeart = false;
      phase = "explode";
    }, 3000); // nổ sau 3 giây

    animate();
  </script>
</body>
</html>
